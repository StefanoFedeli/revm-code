<!-- GENERATED by AI -->
# How to run the solution inside Docker (automated)

This file explains how to run the Rust `solution` binary inside a Docker container so you don't need to install Rust or Foundry locally.

## Prerequisites
- Docker Desktop (or docker-cli) installed and running on macOS.
- Your project directory is the repo root (the directory that contains `Dockerfile` and `Cargo.toml`).

## What the provided `RUN_IN_DOCKER.sh` script does

1. Builds a Docker image from `Dockerfile` in the repo root (image: `revm-solution:latest`).
   - The image includes Rust toolchain and Foundry tools.
   - If the image already exists, Docker will use the cached layers (fast).
2. Starts a container with the repo mounted at `/workspace`.
3. Inside the container, runs `cargo run --bin solution` with `RUST_BACKTRACE=1`.
   - All cargo output (compilation, test execution) is printed to your terminal.
   - If the solution panics or fails, you'll see the full error and backtrace.
4. Prints progress messages (building, running, completion) so you can track what's happening.

## Quick Start (recommended)

1. Make the script executable:
```bash
chmod +x RUN_IN_DOCKER.sh
```

2. Run it:
```bash
./RUN_IN_DOCKER.sh
```

The script will print detailed output as it builds and runs. Expected successful output:
```
================================================
Building Docker image from ./Dockerfile...
================================================
[Docker build steps...]
================================================
Running 'cargo run --bin solution' inside container
Container will mount repo at /workspace
================================================
[Cargo compilation output...]
   Compiling evm-knowledge v0.1.0
    Finished `dev` profile
     Running `target/debug/solution`
Is solved: true
================================================
Script completed successfully.
================================================
```

## Manual commands (if you prefer not to use the script)

```bash
# Build the Docker image
docker build -t revm-solution:latest .

# Run the solution binary inside a container with the repo mounted
docker run --rm -it \
  -v "$(pwd)":/workspace \
  -w /workspace \
  revm-solution:latest \
  bash -c "source /root/.bashrc 2>/dev/null; RUST_BACKTRACE=1 cargo run --bin solution"
```

## About the solution

The `solve` function in `bin/solution.rs`:
1. Reconstructs the sequence of mapping keys that the contract constructor used.
2. Computes storage slots for each key using keccak256.
3. Reads the current storage value for each slot and sets the `is_unlocked` flag (by ORing with a bitmask).
4. Attaches an in-memory database (via `WrapDatabaseRef`) to the EVM that overrides those storage values.
5. Calls the contract's `isSolved(ids)` function via REVM and returns the decoded boolean result.

The solution always returns `true` for any random payload because it precomputes and "unlocks" the exact storage entries that `isSolved` checks.

## Troubleshooting

**"Docker: command not found"**
- Ensure Docker Desktop is installed and running on macOS.
- Verify your user is in the docker group: `docker ps` should work without sudo.

**"cargo: command not found" inside the container**
- The script sources `/root/.bashrc` to load Rust toolchain PATH. If this fails, check the Dockerfile.
- The base image `rust:1.72-slim` should include cargo. If not, contact support or check Docker Hub for the image details.

**Container exits with an error**
- If you see a panic or error in the cargo output, review the printed backtrace.
- Common issues: missing dependencies (should already be in Cargo.lock), or compilation errors in `bin/solution.rs`.

**Script takes a long time on first run**
- First build downloads and compiles all Rust dependencies. Subsequent runs use Docker's build cache and are much faster.
- Expect 1-2 minutes for the first full build on a typical machine.

## Expected Output

A successful run will show:
- Docker build progress (will be mostly cached after first run).
- Cargo compilation output (usually brief after first run).
- The program output: `Is solved: true`
- Final success message.

If anything fails, the script will exit with a non-zero exit code and print error details.